; RadioWall ESP32 Firmware
; PlatformIO Configuration

[env:t-display-s3-long]
platform = espressif32
board = esp32-s3-devkitc-1
framework = arduino

; T-Display-S3-Long specific settings
board_build.mcu = esp32s3
board_build.f_cpu = 240000000L
board_build.flash_size = 16MB
board_upload.flash_size = 16MB

; USB settings - CDC enabled for Serial debugging
; PSRAM enabled for places database in memory
build_flags =
    -DARDUINO_USB_MODE=1
    -DARDUINO_USB_CDC_ON_BOOT=1
    -DBOARD_HAS_PSRAM
    -mfix-esp32-psram-cache-issue
    -DU8G2_FONT_SUPPORT
    -DU8G2_WITH_UNICODE
    -DU8G2_USE_LARGE_FONTS

; Libraries (Arduino_GFX and Arduino_DriveBus are in lib/ folder)
lib_deps =
    ; WiFi & MQTT
    knolleary/PubSubClient@^2.8

    ; JSON parsing
    bblanchon/ArduinoJson@^6.21.0

    ; WiFi captive portal (auto-config)
    https://github.com/tzapu/WiFiManager.git

; Filesystem for places.bin database
board_build.filesystem = littlefs
board_build.partitions = partitions.csv

; Monitor settings
monitor_speed = 115200
monitor_filters = esp32_exception_decoder, send_on_enter, time
monitor_echo = yes

; Upload settings
upload_speed = 921600

; =============================================================================
; USB Touch Mode - Full firmware with external USB touch panel
; =============================================================================
; Flash: pio run -e usb-touch -t upload
; Then unplug USB, power via battery, plug in touch panel via OTG adapter.
; Logs stream over WiFi UDP port 9999 (listen with: python -c "import socket; s=socket.socket(2,2); s.bind(('',9999)); [print(s.recvfrom(1024)[0].decode()) for _ in iter(int,1)]")
[env:usb-touch]
platform = espressif32
board = esp32-s3-devkitc-1
framework = arduino

board_build.mcu = esp32s3
board_build.f_cpu = 240000000L
board_build.flash_size = 16MB
board_upload.flash_size = 16MB

build_flags =
    -DARDUINO_USB_MODE=1
    -DARDUINO_USB_CDC_ON_BOOT=1
    -DBOARD_HAS_PSRAM
    -mfix-esp32-psram-cache-issue
    -DU8G2_FONT_SUPPORT
    -DU8G2_WITH_UNICODE
    -DU8G2_USE_LARGE_FONTS
    -DUSE_BUILTIN_TOUCH=0

; Exclude builtin_touch.cpp (uses different I2C touch, conflicts with USB Host)
build_src_filter = +<*> -<builtin_touch.cpp> -<usb_host_test.cpp>

lib_deps =
    knolleary/PubSubClient@^2.8
    bblanchon/ArduinoJson@^6.21.0
    https://github.com/tzapu/WiFiManager.git

board_build.filesystem = littlefs
board_build.partitions = partitions.csv
monitor_speed = 115200
upload_speed = 921600

; =============================================================================
; USB Host Test - Flash this to test external touch panel
; =============================================================================
; Flash: pio run -e usb-host-test -t upload
; Then unplug USB, power via battery, plug in touch panel via OTG adapter.
; All output goes to the AMOLED display (no serial in USB Host mode).
[env:usb-host-test]
platform = espressif32
board = esp32-s3-devkitc-1
framework = arduino

board_build.mcu = esp32s3
board_build.f_cpu = 240000000L
board_build.flash_size = 16MB
board_upload.flash_size = 16MB

build_flags =
    -DARDUINO_USB_MODE=1
    -DARDUINO_USB_CDC_ON_BOOT=1
    -DBOARD_HAS_PSRAM
    -mfix-esp32-psram-cache-issue
    -DUSB_HOST_TEST

; Only compile the test file (it has its own display init)
build_src_filter = +<usb_host_test.cpp>

lib_deps =

board_build.filesystem = littlefs
board_build.partitions = partitions.csv
upload_speed = 921600
